graph TB
    %% TITLE AND MAIN SECTIONS
    subgraph HabitatEvolution["Habitat Evolution System Architecture (Pattern-Aware RAG Focus with Integrated Field)"]
        subgraph EV["Event System"]
            EV_BUS["Event Bus"]
            EV_SUB["Event Subscribers"]
            EV_PUB["Event Publishers"]
            EV_HAND["Event Handlers"]
        end

        subgraph AC["Adaptive Core Services"]
            AC_ID["Adaptive ID System"]
            AC_PATT["Pattern Models"]
            AC_REL["Relationship Models"]
            AC_PEVO["Pattern Evolution Service"]
            AC_METRICS["Metrics Service"]
            AC_SNAP["Pattern Snapshot Service"]
        end

        subgraph FR["Field & Resonance System"]
            FR_TOPO["Topological Field Analyzer"]
            FR_NAV["Field Navigator"]
            FR_RMAT["Resonance Matrix Constructor"]
            FR_DPROJ["Dimensional Projection"]
            FR_INT["Field-RAG Integration"]
        end

        subgraph PR["Pattern-Aware RAG"]
            PR_CORE["RAG Controller"]
            PR_VEC["Vector Embeddings"]
            PR_LEARN["Learning Window Control"]
            PR_HOOK["Service Hook System"]
            PR_COH["Coherence Calculator"]
            PR_STATE["Pattern State Manager"]
        end

        subgraph VG["Persistence Lab (Neo4j)"]
            VG_NEO["Neo4j Graph Service"]
            VG_PIID["Pattern Adaptive ID"]
            VG_PATT["Pattern Visualizer"]
            VG_BRIDGE["Pattern-Neo4j Bridge"]
            VG_QUERY["Query Template Service"]
            VG_EVOL["Evolution Tracker"]
        end

        subgraph EX["External Integration"]
            EX_DOC["Document Processor"]
            EX_EMB["External Embeddings"]
            EX_INGEST["Data Ingestion"]
        end
    end

    %% EVENT SYSTEM CONNECTIONS
    EV_PUB --> EV_BUS
    EV_BUS --> EV_SUB
    EV_SUB --> EV_HAND

    %% EVENT BUS CONNECTIONS (CENTRAL COORDINATION)
    EV_BUS -.-> AC_ID
    EV_BUS -.-> AC_PEVO
    EV_BUS -.-> PR_LEARN
    EV_BUS -.-> PR_STATE
    EV_BUS -.-> VG_NEO
    EV_BUS -.-> VG_EVOL

    %% ADAPTIVE CORE INTERNAL CONNECTIONS
    AC_ID --> AC_PATT
    AC_PATT --> AC_REL
    AC_PATT --> AC_METRICS
    AC_PATT --> AC_PEVO
    AC_PEVO --> AC_SNAP
    AC_METRICS --> AC_PEVO

    %% FIELD SYSTEM INTERNAL CONNECTIONS
    PR_VEC --> FR_RMAT
    FR_RMAT --> FR_TOPO
    FR_TOPO --> FR_DPROJ
    FR_DPROJ --> FR_NAV
    FR_NAV --> FR_INT
    FR_INT --> PR_HOOK

    %% PATTERN-AWARE RAG INTERNAL CONNECTIONS
    PR_CORE --> PR_VEC
    PR_CORE --> PR_LEARN
    PR_CORE --> PR_HOOK
    PR_VEC --> PR_COH
    PR_COH --> PR_LEARN
    PR_LEARN --> PR_STATE

    %% PERSISTENCE LAB INTERNAL CONNECTIONS
    VG_PIID --> VG_PATT
    VG_PATT --> VG_NEO
    VG_BRIDGE --> VG_NEO
    VG_NEO --> VG_QUERY
    VG_EVOL --> VG_NEO

    %% EXTERNAL INTEGRATION CONNECTIONS
    EX_DOC --> EX_EMB
    EX_EMB --> PR_VEC
    EX_DOC --> EX_INGEST
    EX_INGEST --> AC_PATT

    %% PRIMARY INTEGRATION FLOWS
    
    %% 1. PATTERN EVOLUTION FLOW
    AC_ID -.-> PR_CORE
    AC_PATT -.-> PR_CORE
    AC_PEVO -.-> PR_LEARN
    PR_STATE -.-> AC_SNAP
    
    %% 2. PERSISTENCE FLOW
    AC_SNAP -.-> VG_BRIDGE
    AC_ID -.-> VG_PIID
    AC_PATT -.-> VG_BRIDGE
    PR_STATE -.-> VG_EVOL
    
    %% 3. QUERY FLOW
    VG_QUERY -.-> PR_CORE

    %% 4. FIELD-TO-RAG INTEGRATION FLOWS (CRITICAL VECTOR + TONIC-HARMONIC BRIDGE)
    PR_VEC -.-> FR_RMAT
    FR_NAV -.-> PR_CORE
    FR_TOPO -.-> PR_LEARN
    FR_TOPO -.-> AC_METRICS
    
    %% 5. VISUALIZATION INTEGRATION
    FR_TOPO -.-> VG_PATT

    %% STYLING FOR IMPLEMENTATION FOCUS
    classDef primary fill:#fff0f6,stroke:#eb2f96,stroke-width:4px
    classDef secondary fill:#f9f0ff,stroke:#722ed1,stroke-width:2px
    classDef field fill:#f6ffed,stroke:#52c41a,stroke-width:2px
    
    %% MARK PRIMARY IMPLEMENTATION FOCUS
    class AC_ID primary
    class AC_PATT primary
    class AC_REL primary
    class AC_PEVO primary
    class AC_SNAP primary
    class PR_CORE primary
    class PR_LEARN primary
    class PR_STATE primary
    class VG_PIID primary
    class VG_BRIDGE primary
    class VG_NEO primary
    class VG_EVOL primary
    class EV_BUS primary
    
    %% MARK SECONDARY COMPONENTS
    class AC_METRICS secondary
    class PR_VEC secondary
    class PR_COH secondary
    class PR_HOOK secondary
    class VG_PATT secondary
    class VG_QUERY secondary
    class EX_DOC secondary
    class EX_EMB secondary
    class EX_INGEST secondary
    class EV_SUB secondary
    class EV_PUB secondary
    class EV_HAND secondary
    
    %% MARK FIELD COMPONENTS
    class FR_TOPO field
    class FR_NAV field
    class FR_RMAT field
    class FR_DPROJ field
    class FR_INT field
    
    %% INTERFACE POINTS (PLUGGABILITY)
    class PR_HOOK "Service Hook System:\nPluggable Extension Points\nfor Extensions"
    class VG_BRIDGE "Pattern-Neo4j Bridge:\nTranslates Pattern Events\nto Graph Operations"
    class AC_SNAP "Pattern Snapshot Service:\nCaptures Evolution States\nfor Persistence"
    class FR_INT "Field-RAG Integration:\nConnects Topological Analysis\nto Pattern-Aware Processing"
    class FR_RMAT "Resonance Matrix:\nVector-to-Harmonic Bridge,\nPattern Relationships"